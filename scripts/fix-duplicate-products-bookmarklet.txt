C√ÅC 2: S·ª¨ D·ª§NG BOOKMARKLET (Kh√¥ng c·∫ßn paste v√†o Console)
=========================================================

H∆Ø·ªöNG D·∫™N:
1. T·∫°o bookmark m·ªõi trong Chrome/Edge
2. T√™n: Fix Duplicate Products
3. URL: Copy to√†n b·ªô ƒëo·∫°n code d∆∞·ªõi ƒë√¢y v√† paste v√†o URL c·ªßa bookmark

CODE BOOKMARKLET:
javascript:(function(){console.log('========================================');console.log('üöÄ SCRIPT FIX DUPLICATE PRODUCTS B·∫ÆT ƒê·∫¶U');console.log('========================================');if(typeof localStorage==='undefined'){console.error('‚ùå Ch·ªâ ch·∫°y ƒë∆∞·ª£c trong tr√¨nh duy·ªát (localStorage kh√¥ng t·ªìn t·∫°i)');return}console.log('‚úÖ localStorage ƒë√£ s·∫µn s√†ng');console.log('üîç B·∫Øt ƒë·∫ßu ki·ªÉm tra s·∫£n ph·∫©m tr√πng l·∫∑p...');const getCurrentUserId=()=>{try{const savedUser=localStorage.getItem('auth_user');if(savedUser){const user=JSON.parse(savedUser);return user?.id??user?.userId??null}}catch(error){console.error('Error getting user ID:',error)}return null};const getStorageKey=(baseKey)=>{const userId=getCurrentUserId();if(userId){return`${baseKey}_user_${userId}`}return baseKey};const PRODUCTS_KEY='finmaster_products';const storageKey=getStorageKey(PRODUCTS_KEY);console.log('üìå Storage key ƒëang d√πng:',storageKey);const rawData=localStorage.getItem(storageKey);if(!rawData){console.log('‚ÑπÔ∏è Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu s·∫£n ph·∫©m');console.log('üí° Ki·ªÉm tra t·∫•t c·∫£ keys trong localStorage:');const allKeys=Object.keys(localStorage);console.log('  T·ªïng s·ªë keys:',allKeys.length);const productKeys=allKeys.filter(k=>k.includes('product'));if(productKeys.length>0){console.log('  Keys li√™n quan ƒë·∫øn product:',productKeys)}else{console.log('  Kh√¥ng c√≥ key n√†o ch·ª©a "product"');console.log('  T·∫•t c·∫£ keys:',allKeys)}return}let products=[];try{products=JSON.parse(rawData);if(!Array.isArray(products)){console.error('‚ùå D·ªØ li·ªáu s·∫£n ph·∫©m kh√¥ng ph·∫£i m·∫£ng');return}}catch(e){console.error('‚ùå L·ªói parse JSON:',e);return}const originalCount=products.length;console.log(`üìä T·ªïng s·ªë s·∫£n ph·∫©m hi·ªán t·∫°i: ${originalCount}`);const idCount=new Map();const nameCount=new Map();products.forEach(p=>{if(p.id){idCount.set(p.id,(idCount.get(p.id)||0)+1)}if(p.name){nameCount.set(p.name,(nameCount.get(p.name)||0)+1)}});const duplicateIds=Array.from(idCount.entries()).filter(([id,count])=>count>1);const duplicateNames=Array.from(nameCount.entries()).filter(([name,count])=>count>1);console.log('\nüìà Ph√¢n t√≠ch:');console.log(`  - S·∫£n ph·∫©m tr√πng ID: ${duplicateIds.length} ID b·ªã tr√πng`);if(duplicateIds.length>0){console.log('  Top 5 ID tr√πng nhi·ªÅu nh·∫•t:');duplicateIds.sort((a,b)=>b[1]-a[1]).slice(0,5).forEach(([id,count])=>{const product=products.find(p=>p.id===id);console.log(`    ID ${id}: ${count} l·∫ßn - "${product?.name||'N/A'}"`)})}console.log(`  - S·∫£n ph·∫©m tr√πng t√™n: ${duplicateNames.length} t√™n b·ªã tr√πng`);if(duplicateNames.length>0){console.log('  Top 5 t√™n tr√πng nhi·ªÅu nh·∫•t:');duplicateNames.sort((a,b)=>b[1]-a[1]).slice(0,5).forEach(([name,count])=>{console.log(`    "${name}": ${count} l·∫ßn`)})}const seenIds=new Set();const uniqueProducts=[];const removedProducts=[];const sorted=[...products].sort((a,b)=>{const aHasStock=(a.quantity||0)>0;const bHasStock=(b.quantity||0)>0;if(aHasStock!==bHasStock)return bHasStock?1:-1;const aTime=a.updatedAt||a.createdAt||0;const bTime=b.updatedAt||b.createdAt||0;return bTime-aTime});sorted.forEach(p=>{if(!p.id){console.warn('‚ö†Ô∏è S·∫£n ph·∫©m kh√¥ng c√≥ ID, b·ªè qua:',p);removedProducts.push(p);return}if(seenIds.has(p.id)){removedProducts.push(p);return}seenIds.add(p.id);uniqueProducts.push(p)});const removedCount=originalCount-uniqueProducts.length;console.log(`\n‚úÖ K·∫øt qu·∫£:`);console.log(`  - S·∫£n ph·∫©m ban ƒë·∫ßu: ${originalCount}`);console.log(`  - S·∫£n ph·∫©m sau khi l√†m s·∫°ch: ${uniqueProducts.length}`);console.log(`  - ƒê√£ lo·∫°i b·ªè: ${removedCount} s·∫£n ph·∫©m tr√πng l·∫∑p`);if(removedCount>0){console.log('\nüóëÔ∏è M·ªôt s·ªë s·∫£n ph·∫©m ƒë√£ lo·∫°i b·ªè (top 10):');removedProducts.slice(0,10).forEach(p=>{console.log(`  - ID ${p.id}: "${p.name}" (T·ªìn: ${p.quantity||0})`)});try{localStorage.setItem(storageKey,JSON.stringify(uniqueProducts));console.log('\nüíæ ƒê√£ l∆∞u d·ªØ li·ªáu ƒë√£ l√†m s·∫°ch v√†o localStorage');console.log('üîÑ Nh·∫•n F5 ƒë·ªÉ t·∫£i l·∫°i trang v√† th·∫•y k·∫øt qu·∫£')}catch(e){console.error('‚ùå L·ªói khi l∆∞u d·ªØ li·ªáu:',e)}}else{console.log('\n‚ú® Kh√¥ng c√≥ s·∫£n ph·∫©m tr√πng l·∫∑p, d·ªØ li·ªáu ƒë√£ s·∫°ch!')}const productsByName=new Map();uniqueProducts.forEach(p=>{if(!productsByName.has(p.name)){productsByName.set(p.name,[])}productsByName.get(p.name).push(p)});const multipleByName=Array.from(productsByName.entries()).filter(([name,prods])=>prods.length>1);if(multipleByName.length>0){console.log(`  - ${multipleByName.length} t√™n s·∫£n ph·∫©m c√≥ nhi·ªÅu bi·∫øn th·ªÉ (variants):`);multipleByName.slice(0,5).forEach(([name,prods])=>{console.log(`    "${name}": ${prods.length} variants`);prods.forEach(p=>{console.log(`      - ID ${p.id}, Gi√°: ${p.price}, T·ªìn: ${p.quantity||0}`)})})}console.log('\n========================================');console.log('‚úÖ SCRIPT HO√ÄN TH√ÄNH');console.log('========================================')})();

C√ÅCH D√ôNG:
1. T·∫°o bookmark m·ªõi (Ctrl+D ho·∫∑c click ng√¥i sao tr√™n thanh ƒë·ªãa ch·ªâ)
2. Ch·ªânh s·ª≠a bookmark
3. Paste ƒëo·∫°n code tr√™n v√†o ph·∫ßn URL
4. L∆∞u l·∫°i
5. Khi c·∫ßn ch·∫°y: Click v√†o bookmark l√† xong!

L∆ØU √ù: Ph·∫£i m·ªü app trong tr√¨nh duy·ªát tr∆∞·ªõc khi click bookmark
